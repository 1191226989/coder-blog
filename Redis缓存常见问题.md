---
title: Redis缓存常见问题
created: '2023-07-20T13:29:53.236Z'
modified: '2023-07-20T13:42:27.894Z'
---

# Redis缓存常见问题

#### 1. 缓存穿透（缓存数据未找到）
查询一个数据，在 redis 内存数据库中缓存没有找到，在持久层的数据库中查询也没有找到，大量请求会给数据库造成很大的压力，这种情况就是缓存穿透。

- 解决方案 1 布隆过滤器

> 布隆过滤器是一种数据结构，对所有可能查询的参数以 hash 的形式存储，在控制层先校验，不符合则丢弃，从而避免了对底层存储系统的查询压力。

- 解决方案 2 缓存空对象
> 当存储层数据不存在，返回空的对象也缓存起来，同时设置一个过期时间，之后再访问这个数据将会从缓存中获取，保护后端数据源。

#### 2. 缓存击穿（缓存访问量过大）
当某个 key 在过期的瞬间，有着大量的并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，并写回缓存，会导致数据库瞬间压力太大。

- 解决方案 1 设置热点数据永不过期
> 从缓存层面来看，因为 key 不会过期，所以不会存在热点 key 过期后产生的问题。

- 解决方案 2 分布式加锁
> 保证每一个 key 都只能由一个线程去查询后端服务，其他的线程没有分布式锁的权限，因此只需要等待即可。这种方式将高并发的压力转到了分布式锁。

> golang 语言 singleflight 提供了一个重复的函数调用抑制机制，也是用到了锁，多个协程可以共用一个函数调用结果。

#### 3. 缓存雪崩
指在某一个时间段，缓存集中失效过期。

- 解决方案 1 限流降级 类似缓存击穿

- 解决方案 2 缓存过期时间增加随机值，避免缓存同时过期的情况

- 解决方案 3 数据预热，即在将发生大并发之前手动触发加载缓存 key，设置不同的过期时间，让缓存失效的时间尽量均匀

- 解决方案 4 增加多级缓存

